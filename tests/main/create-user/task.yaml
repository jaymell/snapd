summary: Ensures that create-user functionality behaves as expected

environment:
    USER_EMAIL: mvo@ubuntu.com
    USER_NAME: mvo
details: |
    A snap declaring the mount-observe plug is defined, its command
    just read the /proc/<pid>/mounts file.

    The test itself checks for the lack of autoconnect and then tries
    to execute the snap command with the plug connected (it must succeed)
    and disconnected (it must fail).

    The test also checks that a new mount created after the snap is installed
    is also shown when the plug is connected.

execute: |
    echo "snap create-user without sudo"
    expected="error: bad user result: access denied"
    snap create-user $USER_EMAIL 2>&1 | grep -Pq "$expected"
    echo "sudo snap create-user -- no email address"
    expected="error: bad user result: cannot create user: 'email' field is empty"
    sudo snap create-user 2>&1 | grep -Pq "$expected"

    echo "sudo snap create-user -- valid email address" 
    expected="Created user "\"$USER_NAME\"
    sudo snap create-user $USER_EMAIL 2>&1 | grep -Pq "$expected"

    ### test without extrausers
